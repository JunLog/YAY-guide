# æ•°ç»„ä¸SliceåŸç†

## æ•°ç»„

æ•°ç»„æ˜¯ä¸€ä¸ªå…·æœ‰å›ºå®šé•¿åº¦ä¸”æ‹¥æœ‰0ä¸ªæˆ–è€…å¤šä¸ªç›¸åŒæ•°æ®ç±»å‹å…ƒç´ çš„åºåˆ—ã€‚

æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯é€šè¿‡ç´¢å¼•å»è®¿é—®çš„ï¼Œç´¢å¼•ä»0åˆ°æ•°ç»„é•¿åº¦å‡ä¸€ã€‚Goå†…ç½®çš„å‡½æ•°`len`å¯ä»¥è¿”å›æ•°ç»„ä¸­å…ƒç´ ä¸ªæ•°ã€‚

```go
package main

import "fmt"

func main(){
	var a [3]int
	b:=[3]int{1,2,3}
	c:=[...]int{1,2,3}
	d:=[...]int{9:-1}
	fmt.Println("a:",a)
	fmt.Println("b:",b)
	fmt.Println("c:",c)
	fmt.Println("d:",d)
}
```

![image-20211024192051643](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211024192051.png)

é»˜è®¤æƒ…å†µä¸‹ï¼Œå£°æ˜ä¸€ä¸ªæ•°ç»„`var a [3]int` ,å…ƒç´ çš„åˆå§‹åŒ–å€¼æ˜¯å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚ï¼ˆå¯¹äº`int`,å¯¹åº”çš„é›¶å€¼å°±æ˜¯0ï¼‰

åŒæ—¶å¯ä»¥ä½¿ç”¨æ•°ç»„å­—é¢é‡æ ¹æ®ä¸€ç»„å€¼æ¥åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ï¼ˆ`b:=[3]int{1,2,3}`ï¼‰ã€‚

å¦‚æœçœç•¥å·`...`ä»£æ›¿æ•°ç»„é•¿åº¦ï¼Œé‚£ä¹ˆæ•°ç»„é•¿åº¦ç”±åˆå§‹åŒ–æ•°ç»„çš„å…ƒç´ ä¸ªæ•°å†³å®šã€‚ï¼ˆ`c:=[...]int{1,2,3}` é•¿åº¦ä¸º3ï¼‰

**æ•°ç»„é•¿åº¦æ˜¯æ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚**

é‚£ä¹ˆ`[3]int`å’Œ`[4]int`æ˜¯ä¸¤ä¸ªä¸åŒçš„æ•°ç»„ç±»å‹ã€‚**æ•°ç»„é•¿åº¦å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚**

åŒæ—¶ç»„å€¼å¯ä»¥å…·æœ‰ç´¢å¼•å’Œç´¢å¼•å¯¹åº”çš„å€¼`d:=[...]int{9:-1}`,å®šä¹‰äº†ä¸€ä¸ªæ‹¥æœ‰10ä¸ªå…ƒç´ çš„æ•°ç»„dï¼Œæœ€åä¸€ä¸ªå…ƒç´ å€¼ä¸º-1ï¼Œå…¶ä½™éƒ½æ˜¯0å€¼ã€‚

å½“å‡½æ•°å‚æ•°ä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ•°ç»„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åèµ‹å€¼ç»™å¯¹åº”çš„å‡½æ•°å˜é‡ã€‚Goä¸­**æŠŠæ•°ç»„çœ‹ä½œæ˜¯å€¼ä¼ é€’**ï¼Œè€Œåœ¨å…¶ä»–è¯­è¨€å½“ä¸­ï¼Œæ•°ç»„æ˜¯**éšå¼çš„å¼•ç”¨ä¼ é€’ã€‚**

```go
func test1() {
	arrayA := [2]int{100, 200}
	var arrayB [2]int

	arrayB = arrayA

	fmt.Printf("arrayA : %p , %v\n", &arrayA, arrayA)
	fmt.Printf("arrayB : %p , %v\n", &arrayB, arrayB)

	testArray(arrayA)
}

func testArray(x [2]int) {
	fmt.Printf("func Array : %p , %v\n", &x, x)
}
```

![image-20211024194617478](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211024194617.png)

å¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ªå†…å­˜åœ°å€éƒ½ä¸åŒï¼Œè¿™ä¹Ÿå°±éªŒè¯äº† Go ä¸­æ•°ç»„èµ‹å€¼å’Œå‡½æ•°ä¼ å‚éƒ½æ˜¯å€¼å¤åˆ¶çš„ã€‚

> â“ï¼šé‚£ä¹ˆè¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ

å‡æƒ³æ¯æ¬¡ä¼ å‚éƒ½ç”¨æ•°ç»„ï¼Œé‚£ä¹ˆæ¯æ¬¡æ•°ç»„éƒ½è¦è¢«å¤åˆ¶ä¸€éã€‚å¦‚æœæ•°ç»„å¤§å°æœ‰ 100ä¸‡ï¼Œåœ¨64ä½æœºå™¨ä¸Šå°±éœ€è¦èŠ±è´¹å¤§çº¦ 800W å­—èŠ‚ï¼Œå³ 8MB å†…å­˜ã€‚è¿™æ ·ä¼šæ¶ˆè€—æ‰å¤§é‡çš„å†…å­˜ã€‚

> â—ï¼šè§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼š

ä½¿ç”¨æ•°ç»„æŒ‡é’ˆï¼ŒåŒæ—¶ä¹Ÿå…è®¸è¢«è°ƒå‡½æ•°ä¿®æ”¹è°ƒç”¨æ–¹æ•°ç»„ä¸­çš„å…ƒç´ ã€‚ä½†æ˜¯ä¹Ÿæœ‰ç¼ºç‚¹ï¼šæ•°ç»„æœ¬èº«æ˜¯ä¸å¯å˜çš„ï¼Œæ— æ³•ä¸ºæ•°ç»„æ·»åŠ å’Œåˆ é™¤å…ƒç´ ã€‚

> ğŸ’¡ï¼šç”±äºæ•°ç»„é•¿åº¦ä¸å¯å˜çš„ç‰¹æ€§ç­‰åŸå› ï¼Œé™¤åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¾ˆå°‘ä½¿ç”¨æ•°ç»„ï¼Œä¸€èˆ¬ä½¿ç”¨`Slice`

## åˆ‡ç‰‡

`slice` è¡¨ç¤ºä¸€ä¸ªæ‹¥æœ‰ç›¸åŒç±»å‹å…ƒç´ çš„å¯è¾¹é•¿åº¦çš„åºåˆ—ã€‚

ç”¨åˆ‡ç‰‡è§£å†³ä¸Šé¢é‚£ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆåˆ‡ç‰‡çš„ä¼˜åŠ¿ä¹Ÿä¼šè¡¨ç°å‡ºæ¥ã€‚

**ç”¨åˆ‡ç‰‡ä¼ æ•°ç»„å‚æ•°ï¼Œæ—¢å¯ä»¥è¾¾åˆ°èŠ‚çº¦å†…å­˜çš„ç›®çš„ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°åˆç†å¤„ç†å¥½å…±äº«å†…å­˜çš„é—®é¢˜ã€‚åˆ‡ç‰‡æ˜¯å¼•ç”¨ä¼ é€’ï¼Œæ‰€ä»¥å®ƒä»¬ä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„å†…å­˜å¹¶ä¸”æ¯”ä½¿ç”¨æ•°ç»„æ›´æœ‰æ•ˆç‡ã€‚**

`Slice`ç”±ä¸‰ä¸ªå…ƒç´ ç»„æˆ

* `data` :å…ƒç´ å­˜å“ªé‡Œ
* `len` :å­˜äº†å¤šå°‘ä¸ªå…ƒç´ 
* `cap` :å¯ä»¥å­˜å¤šå°‘ä¸ªå…ƒç´ 

```go
package main

import "fmt"

func main(){
	var egg []int
	//var egg []int=make([]int,2,5)
	//egg=append(egg,1)
	fmt.Printf("addres:%p,first item address:%p len:%v cap:%v data:%v",&egg,egg,len(egg),cap(egg),egg)
}

package main

import "fmt"

func main(){
	//var egg []int
	var egg []int=make([]int,2,5)
	//egg=append(egg,1)
	fmt.Printf("addres:%p,first item address:%p len:%v cap:%v data:%v",&egg,egg,len(egg),cap(egg),egg)
}
```

å½“å®šä¹‰ä¸€ä¸ª`Slice` ,å°±ä¼šæ„é€ ä¸€ä¸ªå¦‚ä¸‹çš„ä¸€ä¸ªç»“æ„

åˆ‡ç‰‡ç»“æ„çš„åœ°å€ä¸º0xc000004078

* dataçš„åœ°å€åˆ™ä¸º0x0 æ²¡æœ‰åˆ†é…åº•å±‚æ•°ç»„ï¼Œè¿™é‡Œå°±ä¸ºnil

* lenä¸º0

* capä¸º0

![image-20211025220403035](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211025220403.png)

å¦‚æœé€šè¿‡makeçš„æ–¹å¼å»å®šä¹‰ä¸€ä¸ªSliceï¼Œå°±ä¼šå®šä¹‰å¦‚ä¸‹æƒ…å†µ

![image-20211025220435472](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211025220435.png)

å½“ä½ ä½¿ç”¨makeå»å®šä¹‰è¿™ä¸ªå˜é‡ï¼Œä¼šåˆ†é…ä¸‰ä¸ªç»“æ„ï¼Œè¿˜ä¼šå¼€è¾Ÿä¸€æ®µå†…å­˜ä½œä¸ºä»–çš„åº•å±‚æ•°ç»„ã€‚è¿˜ä¼šåˆå§‹åŒ–ä¸ºintç±»å‹çš„é›¶å€¼ã€‚

ç›®å‰çš„Sliceåªå­˜å‚¨äº†ä¸¤ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶çš„åˆ‡ç‰‡ç»“æ„

* `data`åº”è¯¥æŒ‡å‘å¼€è¾Ÿæ•°ç»„çš„é¦–åœ°å€
* `len`ä¸º2
* `cap`ä¸º5

```go
package main

import "fmt"

func main(){
	//var egg []int
	var egg []int=make([]int,2,5)
	egg=append(egg,1)
	fmt.Printf("addres:%p,first item address:%p len:%v cap:%v data:%v",&egg,egg,len(egg),cap(egg),egg)
}
```

å½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶å€™ï¼Œä¼šå°†åº•å±‚æ•°ç»„ç¬¬ä¸‰ä½æ”¹æˆ3ï¼Œlenæ”¹æˆ3

![image-20211026141230400](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211026141237.png)

```go
package main

import "fmt"

func main(){
	//var egg []int
	var egg []int=make([]int,2,5)
	egg=append(egg,1)
	egg[0]=1
	fmt.Printf("addres:%p,first item address:%p len:%v cap:%v data:%v",&egg,egg,len(egg),cap(egg),egg)
}
```

å½“æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªå…ƒç´ å€¼æ—¶å€™ï¼Œåœ°å€ç­‰ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œåªæœ‰å€¼å‘ç”Ÿäº†å˜åŒ–ã€‚

![image-20211026141521651](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211026141521.png)

å·²ç»å­˜å‚¨çš„æ˜¯å¯ä»¥è¿›è¡Œå®‰å…¨è¯»å†™çš„ã€‚

> â—ï¼šå¦‚æœè¶…å‡ºlençš„èŒƒå›´è®¿é—®å…ƒç´ ï¼Œå±äºè¶Šç•Œè®¿é—®ï¼Œä¼šå‘ç”Ÿpanic
>
> ![image-20211026141749149](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211026141749.png)

åŒæ—¶å¯ä»¥é€šè¿‡appendå»ä¸ºæœªå¼€è¾Ÿåº•å±‚æ•°ç»„çš„åˆ‡ç‰‡ç»“æ„å¼€è¾Ÿä¸€ä¸ªåº•å±‚æ•°ç»„

```go
package main

import "fmt"

func main(){
	//var egg []int
	var egg []int
	egg=append(egg,1)
	fmt.Printf("addres:%p,first item address:%p len:%v cap:%v data:%v",&egg,egg,len(egg),cap(egg),egg)
}
```

![image-20211026142501669](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211026142501.png)

### åº•å±‚æ•°ç»„

å‰é¢æ‰€æåˆ°çš„ï¼š**æ•°ç»„æ˜¯ä¸€ä¸ªå…·æœ‰å›ºå®šé•¿åº¦ä¸”æ‹¥æœ‰0ä¸ªæˆ–è€…å¤šä¸ªç›¸åŒæ•°æ®ç±»å‹å…ƒç´ çš„åºåˆ—ã€‚**

å®šä¹‰`int`ç±»å‹çš„`slice`ï¼Œé‚£ä¹ˆåº•å±‚æ•°ç»„å¯¹åº”çš„`int`ç±»å‹

å®šä¹‰`string`ç±»å‹çš„`slice`ï¼Œé‚£ä¹ˆåº•å±‚æ•°ç»„å¯¹åº”çš„`string`ç±»å‹

> ğŸ’¡ï¼šåˆ‡ç‰‡ç»“æ„çš„dataä¸ä¸€å®šæŒ‡å‘åº•å±‚æ•°ç»„çš„é¦–åœ°å€ï¼ŒæŒ‡å‘å¼€å§‹å…ƒç´ çš„åœ°å€ã€‚

```go
func main(){
	egg:=[10]int{0,1,2,3,4,5,6,7,8,9}

	ans1:=egg[1:4]
	ans2:=egg[7:]

	fmt.Printf("addres:%p,len:%v cap:%v data:%v \n",&egg,len(egg),cap(egg),egg)
	fmt.Printf("addres:%p,first item address:%p,egg item address:%p len:%v cap:%v data:%v \n",&ans1,ans1,&egg[1],len(ans1),cap(ans1),ans1)
	fmt.Printf("addres:%p,first item address:%p,egg item address:%p len:%v cap:%v data:%v\n",&ans2,ans2,&egg[7],len(ans2),cap(ans2),ans2)
}
```

![image-20211026144659145](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211026144659.png)

**ä¸åŒsliceä¸å£°æ˜çš„æ•°ç»„å¯ä»¥å…±ç”¨ä¸€ä¸ªåº•å±‚æ•°ç»„**

`ans1`ç»“æ„å¦‚ä¸‹ï¼š

* `data`æŒ‡å‘æ•°ç»„ä¸­ç´¢å¼•ä¸º1çš„å…ƒç´ åœ°å€
* `len`ä¸º3
* `cap`ä¸º9

`ans1`çš„å…ƒç´ æ˜¯`egg`ç´¢å¼•1åˆ°4ï¼Œå·¦é—­å³å¼€çš„åŒºé—´ï¼Œå®¹é‡æ˜¯ä»ç´¢å¼•1åˆ°åº•å±‚æ•°ç»„ç»“æŸï¼Œæ‰€ä»¥ä¸º9

`ans2`ç»“æ„å¦‚ä¸‹ï¼š

* `data`æŒ‡å‘æ•°ç»„ä¸­ç´¢å¼•ä¸º7çš„å…ƒç´ åœ°å€
* `len`ä¸º3
* `cap`ä¸º3

`ans2`çš„å…ƒç´ æ˜¯`egg`ç´¢å¼•7åˆ°æ•°ç»„ç»“æŸï¼Œå®¹é‡æ˜¯ä»ç´¢å¼•7åˆ°åº•å±‚æ•°ç»„ç»“æŸï¼Œæ‰€ä»¥ä¸º3

 `ans1`çš„å¯è¯»å†™èŒƒå›´æ˜¯åº•å±‚æ•°ç»„çš„ç´¢å¼•1åˆ°3ï¼Œå¦‚æœæƒ³æ‰©å¤§è¯»å†™èŒƒå›´ï¼Œå¯ä»¥**åˆ©ç”¨appendæˆ–è€…æ”¹å˜sliceçš„èŒƒå›´**

> â“ï¼šé‚£ä¹ˆå¦‚æœans2ä½¿ç”¨appendå»æ·»åŠ å…ƒç´ ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

```go
func main(){
	egg:=[10]int{0,1,2,3,4,5,6,7,8,9}

	ans1:=egg[1:4]
	ans2:=egg[7:]

	ans2=append(ans2,1)
	fmt.Printf("addres:%p,len:%v cap:%v data:%v \n",&egg,len(egg),cap(egg),egg)
	fmt.Printf("addres:%p,first item address:%p,egg item address:%p len:%v cap:%v data:%v \n",&ans1,ans1,&egg[1],len(ans1),cap(ans1),ans1)
	fmt.Printf("addres:%p,first item address:%p,egg item address:%p len:%v cap:%v data:%v\n",&ans2,ans2,&egg[7],len(ans2),cap(ans2),ans2)
}
```

![image-20211026150032973](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211026150033.png)

å› ä¸ºä¹‹å‰ans1ï¼Œans2ä¸eggå…±ç”¨ä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œæ•°ç»„é•¿åº¦æ˜¯ä¸å¯æ”¹å˜çš„ã€‚

æ”¹å˜ans2çš„å¯è¯»å†™èŒƒå›´

* æ”¹å˜ans2çš„sliceèŒƒå›´ï¼Œä½†æ˜¯å¦‚æœå€¼å¤§äºäº†10å°±ä¼šå‘ç”Ÿpanicã€‚
* é€šè¿‡appendï¼Œä¼šå‘ç”Ÿé‡æ–°å¼€è¾Ÿåº•å±‚æ•°ç»„ï¼Œå°†å€¼æ‹·è´ç„¶åæ·»åŠ å€¼ã€‚

å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚**å½“ä½¿ç”¨appendä¸ºans2æ·»åŠ å…ƒç´ ï¼Œans2ä¼šæ–°å¼€è¾Ÿä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œå°†ä¹‹å‰çš„æ•°ç»„å…ƒç´ è¿›è¡Œæ‹·è´ç„¶åä¿®æ”¹åº•å±‚æ•°ç»„çš„å€¼ã€‚**

> â“ï¼šæˆ‘ä»¬åªç»™ans2æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå®¹é‡ä»3å˜æˆäº†6å‘¢ï¼Ÿ

### Sliceæ‰©å®¹è§„åˆ™

> 1ï¸âƒ£:STEP1 é¢„ä¼°æ‰©å®¹åçš„å®¹é‡

é¢„ä¼°è§„åˆ™ï¼š

* å¦‚æœæ‰©å®¹å‰å®¹é‡ç¿»å€å°äºæ‰€éœ€å®¹é‡ï¼ˆoldCap*2<capï¼‰ï¼Œé‚£ä¹ˆæ–°å®¹é‡ç›´æ¥ç­‰äºæ‰€éœ€å®¹é‡ï¼ˆnewcap=capï¼‰

* å½“åŸsliceçš„capï¼ˆoldCap<1024ï¼‰å°äº1024æ—¶ï¼Œæ–°sliceçš„capå˜ä¸ºåŸæ¥çš„2å€ï¼›

* åŸsliceçš„capå¤§äº1024ï¼ˆoldCap>1024ï¼‰æ—¶ï¼Œæ–°sliceå˜ä¸ºåŸæ¥çš„1.25å€

è¯æ˜ï¼š

```go
//è§„åˆ™1
func main() {
	var ans []int
	ans=append(ans,1)
	fmt.Printf("cap:%d\n",cap(ans))
	ans=append(ans,1,2,3,4,5)
	fmt.Printf("cap:%d\n",cap(ans))
}
//è§„åˆ™2
func main() {
  slice := make([]int, 0)
  oldCap := cap(slice)
  for i := 0; i < 4096; i++ {
    slice = append(slice, i)
    newCap := cap(slice)
    if newCap != oldCap {
      fmt.Printf("oldCap = %-4d  after append %-4d  newCap = %-4d\n", oldCap, i, newCap)
      oldCap = newCap
    }
  }
}
```

![image-20211026153502610](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211026153502.png)

![image-20211026152707948](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20211026152707.png)

> 2ï¸âƒ£:STEP2 è®¡ç®—éœ€è¦çš„å†…å­˜å¤§å°

é¢„ä¼°å®¹é‡*å…ƒç´ ç±»å‹å¤§å°

> 3ï¸âƒ£ï¼šSTEP3 åŒ¹é…åˆé€‚çš„å†…å­˜è§„æ ¼

ä¾‹å­ï¼š

newcap=5ï¼Œå®šä¹‰æ˜¯intç±»å‹

éœ€è¦å†…å­˜å¤§å°ä¸º5*8=40ï¼Œä¼šåŒ¹é…åˆ°48çš„å†…å­˜å¤§å°ã€‚

48çš„å†…å­˜å¤§å°å¯ä»¥å­˜6ä¸ªå…ƒç´ ã€‚

## å‚è€ƒæ–‡ç« 

[ã€Golangæºç ç³»åˆ—ã€‘äºŒï¼šSliceå®ç°åŸç†åˆ†æ](https://mp.weixin.qq.com/s/rbilTQKZ6WwlsQvyVA-qVA)

[æ·±å…¥è§£æ Go ä¸­ Slice åº•å±‚å®ç°](https://halfrost.com/go_slice/#toc-0)

