# ç±»å‹ç³»ç»Ÿ

> æ¨èé˜…è¯»ï¼š[ã€Golangã€‘ç±»å‹ç³»ç»Ÿ](https://mp.weixin.qq.com/s/qQsLP5o7U8AG_phzGzbjJg)
>
> [æ·±å…¥ç ”ç©¶ Go interface åº•å±‚å®ç°](https://halfrost.com/go_interface/)

## å‰è¨€

åœ¨ç¼–è¯‘æœŸé—´ï¼Œç¼–è¯‘å™¨çŸ¥é“æ¯ç§ç±»å‹å®šä¹‰å¾—æ–¹æ³•ï¼Œæ–¹æ³•æœ¬è´¨æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•å¾—è°ƒç”¨ä¸Šï¼Œæ¥æ”¶è€…ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ `t.F1()==F1(t)` ç­‰ä»·å¾—åŸå› ã€‚

åˆ°äº†æ‰§è¡Œé˜¶æ®µï¼Œä¸ºäº†æ”¯æŒ**åå°„ï¼Œæ¥å£åŠ¨æ€æ´¾å‘ï¼Œç±»å‹æ–­è¨€**è¿™äº›è¯­è¨€ç‰¹æ€§æˆ–æœºåˆ¶ï¼Œç¼–è¯‘å™¨ä¼šç»™æ¯ç§ç±»å‹ç”Ÿæˆå¯¹åº”å¾—**ç±»å‹æè¿°ä¿¡æ¯**å†™å…¥æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™äº›ç±»å‹æè¿°ä¿¡æ¯å°±æ˜¯**ç±»å‹å…ƒæ•°æ®**ã€‚

ä»¥ä¸‹éƒ½æ˜¯ `Go` è¯­è¨€çš„å†…ç½®ç±»å‹ï¼š

* å†…ç½®å­—ç¬¦ä¸²ç±»å‹ï¼š`string`ã€‚
* å†…ç½®å¸ƒå°”ç±»å‹ï¼š`bool`.
* å†…ç½®æ•°å€¼ç±»å‹ï¼š
  - `int8`ã€`uint8`ï¼ˆ`byte`ï¼‰ã€`int16`ã€`uint16`ã€`int32`ï¼ˆ`rune`ï¼‰ã€`uint32`ã€`int64`ã€`uint64`ã€`int`ã€`uint`ã€`uintptr`ã€‚
  - `float32`ã€`float64`ã€‚
  - `complex64`ã€`complex128`ã€‚

æ³¨ï¼š`byte`æ˜¯`uint8`çš„ä¸€ä¸ªå†…ç½®åˆ«åï¼Œ`rune`æ˜¯`int32`çš„ä¸€ä¸ªå†…ç½®åˆ«åã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ç±»å‹ã€‚

```go
//å¯ä»¥ç»™è‡ªå®šä¹‰ç±»å‹å®šä¹‰æ–¹æ³•ã€‚
type T1 int
//å¯ä»¥ç»™è‡ªå®šä¹‰ç±»å‹å®šä¹‰æ–¹æ³•ã€‚
type T2 struct {
    name string
}
//æ¥å£ç±»å‹æ˜¯æ— æ•ˆçš„æ–¹æ³•æ¥æ”¶è€…
type T3 interface {
    F1()
}
```

æ•°æ®ç±»å‹å¾ˆå¤šï¼Œä¸ç®¡æ˜¯å†…ç½®ç±»å‹è¿˜æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œä»–çš„ç±»å‹å…ƒæ•°æ®æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œè¿™äº›ç±»å‹å…ƒæ•°æ®å…±åŒæ„æˆäº† `Go` è¯­è¨€çš„**ç±»å‹ç³»ç»Ÿ**ã€‚

é‚£ä¹ˆå¼€å§‹æ­£é¢˜å§ï¼

## å†…ç½®æ•°æ®ç±»å‹å…ƒæ•°æ®

æ¯ä¸ªç±»å‹å…ƒæ•°æ®åŸºç¡€ä¿¡æ¯éƒ½æ”¾åˆ°äº† `runtime._type` ç»“æ„ä½“ä¸­ï¼Œä½œä¸ºæ¯ä¸ªç±»å‹å…ƒæ•°æ®çš„ `Header`ã€‚

```go
type _type struct {
    size       uintptr //å¤§å°
    ptrdata    uintptr //å«æœ‰æ‰€æœ‰æŒ‡é’ˆç±»å‹å‰ç¼€å¤§å°
    hash       uint32  //ç±»å‹
    tflag      tflag //ç±»å‹çš„ç‰¹å¾æ ‡è®°
    align      uint8 //ä½œä¸ºæ•´ä½“å˜é‡å­˜æ”¾æ—¶çš„å¯¹é½å­—èŠ‚æ•°
    fieldalign uint8 //å½“å‰ç»“æ„å­—æ®µçš„å¯¹é½å­—èŠ‚æ•°
    kind       uint8 //åŸºç¡€ç±»å‹æšä¸¾å€¼å’Œåå°„ä¸­çš„ Kind ä¸€è‡´ï¼Œkind å†³å®šäº†å¦‚ä½•è§£æè¯¥ç±»å‹
    alg        *typeAlg //æŒ‡å‘ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆè¡¨ï¼Œè¯¥è¡¨æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯è®¡ç®—ç±»å‹ Hash å‡½æ•°ã€‚å¦ä¸€ä¸ªæ˜¯æ¯”è¾ƒä¸¤ä¸ªç±»å‹æ˜¯å¦ç›¸åŒçš„ equal å‡½æ•°
    gcdata     *byte //GC ç›¸å…³
    str        nameOff  //ç±»å‹åç§°å­—ç¬¦ä¸²åœ¨äºŒè¿›åˆ¶æ–‡ä»¶æ®µä¸­çš„åç§»é‡
    ptrToThis  typeOff //ç±»å‹å…ƒä¿¡æ¯æŒ‡é’ˆåœ¨äºŒè¿›åˆ¶æ–‡ä»¶æ®µä¸­çš„åç§»é‡
}
```

`_type` å­˜å‚¨åŸºæœ¬ä¿¡æ¯ï¼Œè¿˜æœ‰é¢å¤–éœ€è¦æè¿°çš„ä¿¡æ¯ä¹Ÿéœ€è¦å­˜å‚¨ã€‚ä¾‹å¦‚ `slice` çš„ç±»å‹å…ƒæ•°æ®åœ¨ `_type` ç»“æ„ä½“åé¢è®°å½•äº†ä¸€ä¸ª `*_type`ï¼ŒæŒ‡å‘å…¶å­˜å‚¨å…ƒç´ çš„ç±»å‹å…ƒæ•°æ®ã€‚

```go
type slicetype struct {
    typ   _type
    elem  *_type //æŒ‡å‘å­˜å‚¨å…ƒç´ çš„ç±»å‹å…ƒæ•°æ®ï¼Œå¦‚æœå­˜å‚¨stringç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ string ç±»å‹çš„å…ƒæ•°æ®
}
```

æŒ‡é’ˆç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

```go
type ptrtype struct {
    typ   _type
    elem  *_type //æŒ‡å‘ æŒ‡é’ˆç±»å‹æŒ‡å‘çš„ç±»å‹å…ƒæ•°æ® ä¾‹å¦‚ *int é‚£ä¹ˆelemæŒ‡å‘ int ç±»å‹çš„å…ƒæ•°æ®
}
```

æœ‰äº›å†…ç½®ç±»å‹å°±æ²¡æœ‰è¿™ä¹ˆç®€å•ã€‚ä¾‹å¦‚ `map`ï¼Œ`struct`ã€‚

```go
type maptype struct {
	typ    _type
	key    *_type
	elem   *_type
	bucket *_type // internal type representing a hash bucket
	// function for hashing keys (ptr to key, seed) -> hash
	hasher     func(unsafe.Pointer, uintptr) uintptr
	keysize    uint8  // size of key slot
	elemsize   uint8  // size of elem slot
	bucketsize uint16 // size of bucket
	flags      uint32
}
type structtype struct {
	typ     _type
	pkgPath name
	fields  []structfield
}
```

ä½†æ˜¯åŸºæœ¬ç»“æ„éƒ½æ˜¯å¦‚æ­¤ã€‚å¯ä»¥æ¥ [type.go](https://go.dev/src/runtime/type.go) æ¥çœ‹çœ‹å†…ç½®ç±»å‹çš„å…ƒæ•°æ®

## è‡ªå®šä¹‰ç±»å‹å…ƒæ•°æ®

å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œé‚£ä¹ˆç±»å‹å…ƒæ•°æ®çš„ç»“æ„ä½“åé¢è¿˜ä¼šæœ‰ä¸€ä¸ª `uncommontype` ç»“æ„ä½“ã€‚

```go
type uncommontype struct {
    pkgpath nameOff //è®°å½•ç±»å‹æ‰€åœ¨çš„åŒ…è·¯å¾„ï¼›
    mcount  uint16  // è®°å½•äº†è¯¥ç±»å‹å…³è”åˆ°å¤šå°‘ä¸ªæ–¹æ³•ï¼›
    _       uint16 // unused
    moff    uint32  //è®°å½•çš„æ˜¯è¿™äº›æ–¹æ³•çš„å…ƒæ•°æ®ç»„æˆçš„æ•°ç»„ï¼Œç›¸å¯¹äºè¿™ä¸ªuncommontypeç»“æ„ä½“åç§»äº†å¤šå°‘å­—èŠ‚ã€‚
}
//æ–¹æ³•å…ƒæ•°æ®
type method struct {
    name nameOff // æ–¹æ³•åç§°åç§»é‡ 
    mtyp typeOff //æ–¹æ³•çš„ç±»å‹å…ƒæ•°æ®
    ifn  textOff //fn used in interface call (one-word receiver)
    tfn  textOff //fn used for normal method call
}
```

ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼š

```go
type myslice []string //å®šä¹‰äº†ä¸€ä¸ªæ–°çš„ç±»å‹ myslice
//å®šä¹‰çš„ä¸¤ä¸ªæ–¹æ³•
func (ms myslice) Len(){
    fmt.Println(len(ms))
}
func (ms myslice) Cap(){
    fmt.Println(cap(ms))
}
```

`myslice` ç±»å‹å…ƒæ•°æ®ç”±ä»¥ä¸‹æ„æˆï¼š

* `slicetype` ç±»å‹æè¿°ä¿¡æ¯
* `uncommontype` ç»“æ„ä½“

æ³¨ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ `uncommontype` ç»“æ„ä½“æ‰¾åˆ° `myslice` çš„æ–¹æ³•å…ƒæ•°æ®åˆ—è¡¨ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ibjI8pEWI9L6zYKaJegOORJTgR9YoDe543OpVCTUInWcbfDosK4qObJFAPjMWGX5H1icdYE7gHUq2S2KbbpDJBKA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

## alias åˆ«å

åœ¨å†…ç½®æ•°æ®é‡Œé¢ï¼Œ`byte`æ˜¯`uint8`çš„ä¸€ä¸ªå†…ç½®åˆ«åï¼Œ`rune`æ˜¯`int32`çš„ä¸€ä¸ªå†…ç½®åˆ«åã€‚

ä»¥ä¸‹æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä»–ä»¬æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ

```go
type MyType1 = int32
type MyType2 int32
```

* ç¬¬ä¸€ç§æ–¹å¼å«åšç±»å‹ `int32` å–åˆ«åã€‚å®é™…ä¸Š `MyType1` å’Œ `int32` ä¼šå…³è”åˆ°åŒä¸€ä¸ªç±»å‹å…ƒæ•°æ®ï¼Œå±äºåŒä¸€ç§ç±»å‹ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ibjI8pEWI9L6zYKaJegOORJTgR9YoDe54FfpzsjyfEhRNOM8K1wfKSXRsDrLUrWfeU8SyNDx8pw2b0Jb3AOZG7A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

* ç¬¬äºŒç§æ–¹å¼å±äºåˆ›å»ºæ–°ç±»å‹ï¼Œæ‹¥æœ‰è‡ªå·±çš„ç±»å‹å…ƒæ•°æ®ï¼Œ`MyType2` å’Œ `int32` æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ï¼Œå¯¹åº”å…ƒæ•°æ®ä¹Ÿä¼šä¸åŒã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ibjI8pEWI9L6zYKaJegOORJTgR9YoDe54rmcOeCBMj9LjkDERA1W4Q1dQH1ibqUbvonqZZUI1eUhDZGQLwAlfRVg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)