# æ–¹æ³•

> å‚è€ƒé˜…è¯»ï¼š[ã€Golangã€‘æ–¹æ³• Method](https://mp.weixin.qq.com/s/z2i1evUStbMHOZwq__SmRQ)

## ä»‹ç»

æ–¹æ³•å³ `Method`ï¼Œåªè¦ä½ æ¥è§¦è¿‡é¢å¯¹å¯¹è±¡æ€æƒ³çš„è¯­è¨€ï¼Œéƒ½ä¼šäº†è§£ã€‚Go è¯­è¨€æ”¯æŒä¸ºä»»æ„ç±»å‹å®ç°æ–¹æ³•ã€‚

ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼š

```go
type A struct {
	name string
}
func (a A) Name() string {
	a.name = "Hi! " + a.name
	return a.name
}
func main() {
	a := A{name: "eggo"}
	// 1ï¼‰ç¼–è¯‘å™¨çš„è¯­æ³•ç³–ï¼Œæä¾›é¢å‘å¯¹è±¡çš„è¯­æ³•
	fmt.Println(a.Name())//Hi! eggo
	// 2ï¼‰æ›´è´´è¿‘çœŸå®å®ç°çš„å†™æ³•ï¼Œå’Œæ™®é€šå‡½æ•°è°ƒç”¨å‡ ä¹æ²¡ä»€ä¹ˆä¸åŒ
	fmt.Println(A.Name(a))//Hi! eggo
}
```

ä¸Šé¢æœ‰ä¸¤ç§å†™æ³•ï¼Œéƒ½èƒ½é¡ºåˆ©é€šè¿‡ç¼–è¯‘å¹¶ä¸”æ‰§è¡Œï¼Œå®é™…ä¸Šè¿™ä¸¤ç§å†™æ³•ä¼šç”ŸæˆåŒæ ·çš„æœºå™¨ç ã€‚

ç¬¬ä¸€ç§ï¼š`a.Name()`ï¼Œæ¯”è¾ƒå¸¸è§„ï¼Œæ–¹ä¾¿ã€‚è¿™æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚

ç¬¬äºŒç§ï¼š`A.Name(a)`ï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒä¸¥è°¨å†™æ³•çš„ï¼Œæ›´è´´è¿‘äºåŸå§‹ã€‚

è¿™ä¸¤è€…æ˜¯ç­‰ä»·çš„ï¼Œç¼–è¯‘å™¨ä¼šè¯†åˆ«ç¬¬ä¸€ç§ï¼Œç„¶åå¸®æˆ‘ä»¬æŠŠç¬¬ä¸€ç§è½¬å˜æˆç¬¬äºŒç§ã€‚ä»¥ä¸‹æ˜¯è¯æ®ï¼š

```go
type A struct {
	name string
}
func (a A) Name() string {
	a.name = "Hi! " + a.name
	return a.name
}
func Name(a A) string {
	a.name = "Hi! " + a.name
	return a.name
}
func main() {
	t1 := reflect.TypeOf(A.Name)
	t2 := reflect.TypeOf(Name)
	// ä¼šè¾“å‡ºtrueï¼Œé€šè¿‡åå°„æ¥éªŒè¯ï¼Œä¸¤è€…çš„ç±»å‹æ˜¯ç›¸åŒçš„
	fmt.Println(t1 == t2)//true
}
```

è¾“å‡º `True`ï¼Œä»£è¡¨ä¸¤è€…ç±»å‹ä¸€è‡´ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ç¬¬äºŒç§æ–¹å¼å°†ç±»å‹ä¸º `A` çš„å˜é‡ `a`ï¼Œä½œä¸ºå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°å¼•å…¥ï¼Œå…¶ä½™çš„éƒ¨åˆ†éƒ½æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚è¯´æ˜ï¼šæ–¹æ³•æœ¬è´¨ä¸Šå…¶å®ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œåªä¸è¿‡ä¼šå°†å®šä¹‰çš„å˜é‡ `a` ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼ˆéšå«ï¼‰ã€‚

## å€¼æ¥æ”¶è€…

```go
type A struct {
	name string
}
func (a A) Name() string {
	a.name = "Hi! " + a.name
	return a.name
}
func main() {
	a := A{name: "eggo"}
	// 1ï¼‰ç¼–è¯‘å™¨çš„è¯­æ³•ç³–ï¼Œæä¾›é¢å‘å¯¹è±¡çš„è¯­æ³•
	fmt.Println(a.Name())//Hi! eggo
	// 2ï¼‰æ›´è´´è¿‘çœŸå®å®ç°çš„å†™æ³•ï¼Œå’Œæ™®é€šå‡½æ•°è°ƒç”¨å‡ ä¹æ²¡ä»€ä¹ˆä¸åŒ
	fmt.Println(A.Name(a))//Hi! eggo
	fmt.Println(a.name)//eggo
}
```

æ—¢ç„¶å’Œæ™®é€šå‡½æ•°ä¸€è‡´ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ†æä¸€ä¸‹ä»– `a.Name()` çš„å‡½æ•°è°ƒç”¨æ ˆã€‚

`main` å‡½æ•°æ ˆå¸§å±€éƒ¨å˜é‡ä¸º `a` ç±»å‹ `A`ï¼Œæœ‰ä¸€ä¸ª `string` ç±»å‹çš„æˆå‘˜ï¼Œæ‰€ä»¥ä»–çš„æ•°æ®ä¼šè¢«æ”¾åˆ°æ•°æ®æ®µï¼Œåœ¨å±€éƒ¨å˜é‡åˆ™æ˜¯åœ°å€ï¼Œ`a.Name()` ä¼šè¢«ç¼–è¯‘å™¨è½¬åŒ–ä¸º `A.Name(a)` è¿™æ ·çš„å‡½æ•°è°ƒç”¨ã€‚æ‰€ä»¥å‚æ•°æ˜¯ aï¼Œä¼šå€¼æ‹·è´åˆ°å‚æ•°ç©ºé—´ã€‚

å½“å‡½æ•° `A.Name(a)` æ‰§è¡Œæ—¶å€™ï¼Œæ”¹å˜çš„æ˜¯å‚æ•°ç©ºé—´ `a` çš„ `string` æˆå‘˜ `name`ï¼Œé‚£ä¹ˆæ•°æ®æ®µä¼šé‡æ–°å»ºç«‹ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°† `name` çš„åœ°å€æŒ‡å‘è¿™ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚ç„¶åå€¼æ‹·è´æˆå‘˜åˆ°è¿”å›å€¼ç©ºé—´ã€‚æ‰€ä»¥ä¼šè¾“å‡º `Hi! eggo` ã€‚

ä½†æ˜¯å±€éƒ¨å˜é‡ `a` å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚å› ä¸ºä½œä¸ºå€¼æ¥æ”¶è€…å»è°ƒç”¨æ–¹æ³•ï¼Œä¼ å‚éƒ½æ˜¯å€¼æ‹·è´ï¼Œæ”¹å˜çš„æ˜¯å‚æ•° `a`ï¼Œè€Œä¸æ˜¯å±€éƒ¨å˜é‡ `a`ã€‚å¦‚æœä½ æƒ³æ”¹å˜å€¼ï¼Œéœ€è¦åˆ©ç”¨æŒ‡é’ˆæ¥æ”¶è€…ã€‚

## æŒ‡é’ˆæ¥æ”¶è€…

```go
type A struct {
	name string
}
func (pa *A) Name() string {
	pa.name = "Hi! " + pa.name
	return pa.name
}
func main() {
	a := A{name: "eggo"}
	pa := &a
    //æ³¨ï¼šè¿™é‡Œå‡½æ•°è°ƒç”¨äº†ä¸¤æ¬¡æ‰€ä»¥æ˜¯ä¸¤ä¸ª Hiï¼ã€‚
	fmt.Println(pa.Name()) //Hi! eggo
	fmt.Println((*A).Name(pa))//Hi! Hi! eggo
	fmt.Println(pa.name)//Hi! Hi! eggo
}
```

ç°åœ¨æ˜¯æŒ‡é’ˆæ¥æ”¶è€…ï¼Œé‚£ä¹ˆå‡½æ•°è°ƒç”¨æ ˆåˆä¼šæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

main å‡½æ•°è°ƒç”¨æ ˆæœ‰ä¸¤ä¸ªå±€éƒ¨å˜é‡åˆ†åˆ«æ˜¯ `a,pa`ã€‚`pa` æ˜¯å­˜å‚¨å˜é‡ `a` çš„åœ°å€ã€‚`pa.Name()` ä¼šç”±ç¼–è¯‘å™¨è½¬æ¢ä¸º`(*A).Name(pa)` å‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥å‚æ•°ç©ºé—´æ‹·è´å‚æ•° `pa` çš„å€¼ï¼Œä¹Ÿå°±æ˜¯å±€éƒ¨å˜é‡ `a` çš„åœ°å€ã€‚

å½“å‡½æ•° `(*A).Name(pa)` æ‰§è¡Œæ—¶å€™ï¼Œä¼šæ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åå‚æ•° &a çš„ string ç±»å‹æˆå‘˜ä¼šé‡æ–°æŒ‡å‘è¿™ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œç„¶åå€¼æ‹·è´ `string` ç±»å‹çš„æˆå‘˜åˆ°è¿”å›å€¼ç©ºé—´ï¼Œæ‰€ä»¥ä¼šè¾“å‡º `Hi! eggo`ã€‚

å› ä¸ºå‚æ•°æ‹·è´çš„æ˜¯ `pa` ä¹Ÿå°±æ˜¯ `a`çš„åœ°å€ï¼Œæ‰€ä»¥ä¼šè¿™é‡Œä¼šæ”¹å˜ `a` çš„ `string` ç±»å‹æˆå‘˜åœ°å€æŒ‡å‘çš„ `string` ç»“æ„ä½“çš„å€¼ã€‚

## è¯­æ³•ç³–

```go
type A struct {
	name string
}
func (a A) GetName() string {
	return a.name
}
func (pa *A) SetName() string {
	pa.name = "Hi! " + pa.name
	return pa.name
}
func main() {
	a := A{name: "eggo"}
	pa := &a
	fmt.Println(pa.GetName())//eggo
	fmt.Println(a.SetName())//Hi! eggo
	fmt.Println(a.name)//Hi! eggo
}
```

æœ‰æ²¡æœ‰æ„Ÿè§‰è°ƒç”¨çš„å¾ˆå¥‡æ€ªï¼è°ƒç”¨è€…å’Œæ–¹æ³•éƒ½ä¸å¤ªæ­ï¼

è¿™é‡Œæ˜¯è¯­æ³•ç³–ï¼Œç¼–è¯‘æœŸé—´ï¼Œä¼šæŠŠ `pa.GetName()` è¿™ç§æ–¹æ³•è°ƒç”¨è½¬æ¢æˆ `(*pa).GetName()`ï¼Œä¹Ÿå°±ç­‰ä»·äºæ‰§è¡Œ `A.GetName(*pa)`ã€‚è€Œ `a.SetName()` ä¼šè¢«è½¬æ¢æˆ `(&a).SetName()`ï¼Œä¹Ÿç›¸å½“äºæ‰§è¡Œ`(*A).SetName(&a)`ã€‚

ä½†æ˜¯è¿™ç§è¯­æ³•ç³–ä¸èƒ½ç”¨äº`å­—é¢é‡`ã€‚

```go
fmt.Println((A{name: "eggo"}).SetName())
//æŠ¥é”™ï¼šCannot call a pointer method on '(A{name: "eggo"})'

```

è¿™æ ·æ˜¯æ‹¿ä¸åˆ°å­—é¢é‡çš„åœ°å€çš„ï¼Œæ‰€ä»¥è½¬åŒ–æˆæŒ‡é’ˆæ¥æ”¶è€…è°ƒç”¨ã€‚

```go
fmt.Println((A{name: "eggo"}).GetName())//ä¸ä¼šæŠ¥é”™ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å€¼æ¥æ”¶è€…ã€‚
```

## æ–¹æ³•çš„ Function value

Goè¯­è¨€ä¸­å‡½æ•°ä½œä¸ºå˜é‡ã€å‚æ•°å’Œè¿”å›å€¼æ—¶ï¼Œéƒ½æ˜¯ä»¥ `Function Value` çš„å½¢å¼å­˜åœ¨çš„ã€‚ä¹ŸçŸ¥é“é—­åŒ…åªæ˜¯æœ‰æ•è·åˆ—è¡¨(`catch list`)çš„ `Funtion Value` è€Œå·²ã€‚

> æ–¹æ³•è¡¨è¾¾å¼

```go
type A struct {
	name string
}
func (a A) GetName() string {
	return a.name
}
func main(){
	a := A{name:"eggo"}

	f1 := A.GetName      //æ–¹æ³•è¡¨è¾¾å¼
	fmt.Println(f1(a))               //eggo

	f2 := a.GetName      //æ–¹æ³•å˜é‡
	fmt.Println(f2())                  //eggo
}
```

å¦‚æœåƒ `f1` è¿™æ ·ï¼ŒæŠŠä¸€ä¸ªç±»å‹çš„æ–¹æ³•èµ‹å€¼ç»™ä»–ï¼Œè¿™æ ·çš„å˜é‡å°±è¢«ç§°ä¸º**â€œæ–¹æ³•è¡¨è¾¾å¼â€**ã€‚å…¶å®ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼šf1 è¢«èµ‹å€¼çš„æ˜¯ç±»å‹ `A` çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä½¿ç”¨æ–¹æ³• `A.Name(a)`ã€‚æ‰€ä»¥ `f1` çš„è°ƒç”¨æ–¹å¼æ˜¯ä¼ å…¥ä¸€ä¸ª `A` ç±»å‹å˜é‡ `a`ã€‚

ä½ å¯ä»¥å½“ä½œåœ¨ä½¿ç”¨ `A.Name(a A)` è¿™ä¸ªå‡½æ•°ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ibjI8pEWI9L44bYTmxkYjVu1P3PkvCtQviaxRoRglIcneX6KLxjX0RonABGUyiabo7nsWzNbgf8axWzv3XhXic0Kibg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

> æ–¹æ³•å˜é‡

åƒ `f2` è¿™æ ·ï¼Œé€šè¿‡ `a.GetName` è¿›è¡Œèµ‹å€¼ï¼Œè¿™æ ·çš„å˜é‡è¢«ç§°ä¸º**â€œæ–¹æ³•å˜é‡â€**ã€‚é€šè¿‡æ–¹æ³•å˜é‡æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬æ— éœ€å†ä¼ å…¥æ–¹æ³•æ¥æ”¶è€…ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨æ›¿æˆ‘ä»¬åšäº†å¤„ç†ï¼Œç›¸å½“äº `f2()==A.Name(a)`ã€‚

> ä½œä¸ºè¿”å›å€¼

```go
type A struct {
	name string
}
func (a A) GetName() string {
	return a.name
}
func GetFunc() func() string {
	a := A{name: "eggo in GetFunc"}
	return a.GetName
}
//ç­‰ä»·äº
/*
func GetFunc() func() string {
	a := A{name: "eggo in GetFunc"}
	return func() string {
		return a.GetName()
	}
}
*/
//è¿›è€Œç­‰ä»·äº
/*
func GetFunc() func() string {
	a := A{name: "eggo in GetFunc"}
	return func() string {
		return A.GetName(a)
	}
}
*/
func main() {
	a := A{name: "eggo in main"}
	f2 := a.GetName
	fmt.Println(f2()) //è¿™é‡Œè¾“å‡ºï¼šeggo in main

	f3 := GetFunc()
	fmt.Println(f3()) //è¿™é‡Œè¾“å‡ºï¼šeggo in GetFunc
}
```

æˆ‘ä»¬å¯ä»¥å‘ç°å¤šæ¬¡ç­‰ä»·åï¼Œå‘ç°å˜é‡ `a` æ˜¯æ•è·å˜é‡ï¼Œ`f3` æ˜¯é—­åŒ…å¯¹è±¡ã€‚`f2` è¿™ä¸ªæ–¹æ³•å˜é‡ï¼Œä½¿ç”¨çš„æ˜¯ `main` å‡½æ•°çš„å±€éƒ¨å˜é‡ `a`ã€‚è¿™æ ·å°±å¾ˆå¥½ç†è§£ä¸Šé¢è¿™æ®µç¤ºä¾‹ç¨‹åºçš„è¾“å‡ºç»“æœäº†ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/ibjI8pEWI9L44bYTmxkYjVu1P3PkvCtQvqGXpIheCibf6xZpEJ8GE2plvIQd6IoQKticlft4a8pg2FzpEKQqPFl2A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)
