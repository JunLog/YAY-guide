# 项目相关代码规范与设计

## 前言

> 我没有找到，一些专门去描述这些的代码规范，都是从GF文档偷师过来的。
>
> 截取一部分，我自己感觉写项目可能会需要的部分

## 代码分层

 `3-Tier Architecture`

常见三层架构设计模型

![三层架构设计模式](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20210928152137.png)

###  表现层-`UI`

`User Interface` 在这里层里面，是直接与用户进行接触的。对于一个web项目来说，这里主要是`api` 接口。

实现两个方面：

* 收到数据或者参数，校验后传送到`BLL` 系统里面进行数据处理
* `BLL`会将反馈 结果返回到表现层，进而返回到用户

### 业务逻辑层-`BLL`

`Business Logic Layer`的功能主要做对实际问题的逻辑判断和执行操作。对于web项目来说，这里是数据层与表现层的中间桥梁。

当表现层传送数据后，就根据具体需求完成逻辑任务，拿到数据层的信息，完成数据增删改查等功能，将处理的结果返回到表现出。

实现的方面：

* 收到数据或者参数，根据需求处理信息，调用数据层功能，完成具体需求
* 将获得的数据根据要求进行返回到表现层

### 数据访问层-`DAL`

`Data Access Layer` 主要功能是控制数据库，实现对数据库种的数据增删改查等功能，在web项目中，对数据库中的数据进行访问和操作。这里没有逻辑判断能力，只是单单完成具体要求，返回数据。

实现的方面：

* 完成对数据的增删改查等功能，进行封装方便BLL层进行调用，获取相应的数据

### 模型定义层-`Model`

模型定义也常用`Entity`实体对象来表示，主要用于数据库表的映射对象。主要服务于表现层，业务逻辑层以及数据访问层，实现三层数据传输。

### 项目推荐代码分层结构

```
/
├── app
│   ├── api
│   ├── dao
│   ├── model
│   └── service
├── boot
├── config
├── docker
├── document
├── i18n
├── library
├── packed
├── public
├── router
├── template
├── Dockerfile
├── go.mod
└── main.go
```

| 目录/文件名称 | 说明       | 描述                                                         |
| :------------ | :--------- | :----------------------------------------------------------- |
| `app`         | 业务逻辑层 | 所有的业务逻辑存放目录。                                     |
| - `api`       | 业务接口   | 接收/解析用户输入参数的入口/接口层。                         |
| - `dao`       | 数据访问   | 数据库的访问操作，仅包含最基础的数据库`CURD`方法             |
| - `model`     | 结构模型   | 数据结构管理模块，管理数据实体对象，以及输入与输出数据结构定义。 |
| - `service`   | 逻辑封装   | 业务逻辑封装管理，特定的业务逻辑实现和封装。                 |
| `boot`        | 初始化包   | 用于项目初始化参数设置，往往作为`main.go`中第一个被`import`的包。 |
| `config`      | 配置管理   | 所有的配置文件存放目录。                                     |
| `docker`      | 镜像文件   | `Docker`镜像相关依赖文件，脚本文件等等。                     |
| `document`    | 项目文档   | Documentation项目文档，如: 设计文档、帮助文档等等。          |
| `i18n`        | I18N国际化 | I18N国际化配置文件目录。                                     |
| `library`     | 公共库包   | 公共的功能封装包，往往不包含业务需求实现。                   |
| `packed`      | 打包目录   | 将资源文件打包的`Go`文件存放在这里，`boot`包初始化时会自动调用。 |
| `public`      | 静态目录   | 仅有该目录下的文件才能对外提供静态服务访问。                 |
| `router`      | 路由注册   | 用于路由统一的注册管理。                                     |
| `template`    | 模板文件   | `MVC`模板文件存放的目录。                                    |
| `Dockerfile`  | 镜像描述   | 云原生时代用于编译生成Docker镜像的描述文件。                 |
| `go.mod`      | 依赖管理   | 使用`Go Module`包管理的依赖描述文件。                        |
| `main.go`     | 入口文件   | 程序入口文件。                                               |

## 对象封装设计

### 业务包名约束

包对外的公开对象采用`业务领域名称`来命名。

包内部的数据结构定义采用`业务领域名称+分层名称`来命名，其中分层名称一般为`api`或`service`

![对象封装设计 - 图1](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20210928165318.png)

### `model` 数据结构

`model`层级中的代码仅包含数据结构定义，不包含任何的方法封装。同时，`model`中也会包含公开的常量的一些定义。

数据模型的命名直接使用`业务领域名称`，定义`api/service`输入输出的数据结构命名采用`业务领域名称+分层名称`，其他自定义的数据结构均需要带`业务领域名称`前缀，以方便区分同一包下的不同领域相关资源。

![对象封装设计 - 图7](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20210928170707.png)

### `dao`数据访问

我们通过将业务逻辑解耦后，`dao`层的代码仅包含一些通用的数据操作方法，代码往往通过工具生成，很少会有自定义数据封装方法的情况。并且`dao`往往只能被`service`调用，不应当被`api`调用，否则会出现循环依赖的问题。

### 对象访问安全

由于各分层中的封装对象都是以”**可变变量**“的形式对外暴露使用，因此存在被修改的安全风险。因此大家注意这些公开的对象不要包含可修改方法、不要设置公开属性（通过公开方法暴露内部属性），并且建议以非指针（也尽量不要以接口）方式公开这些对象

![对象封装设计 - 图10](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20210928171009.png)

## 数据模型与业务模型

### 数据模型

持久化数据模型

> 持久化的数据模型又可以叫做数据集合模型，主要是来自于底层持久化数据库的数据结构。根据Mysq等等生成对应的程序数据模型代码。

自定义数据模型

> - 对持久化数据模型的封装，例如：扩展、覆盖。
> - 对持久化数据模型的裁剪，例如：针对特定业务场景，基于持久化数据模型的字段进行裁剪后重新组织。
> - 自定义的数据结构，例如，自定义的持久化数据模型（如`Kafka`、`Redis`等数据库不支持自动生成`/app/model/internal`代码的场景）。

### 业务模型

接口输入/输出模型用于系统/服务间的接口交互，被`api`层调用

![数据模型与业务模型 - 图6](https://cdn.jsdelivr.net/gh/baici1/image-host/newimg/20210928172309.png) 业务输入/输出模型

> 业务输入/输出模型用于进程内部模块/组件之间的方法调用交互，特别是`api->service`之间的调用。

## DAO数据访问对象设计

我感觉GF这篇文档，不需要总结。本身就是学习的文章。

https://www.bookstack.cn/read/goframe-1.16-zh/1805c7a946ef823e.md

